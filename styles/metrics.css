/* row under the map: metrics (left) */
.below-map{
  display:grid;
  gap:22px;
  margin-top:16px;
}
@media (min-width:1100px){
  .below-map{
    grid-template-columns: 1fr;
    align-items:start;
  }
}

/* cards inside the row */
.below-map .card{
  width:100%;
  box-sizing:border-box;
  /* padding:18px 60px; */
  padding:24px 36px;
  border-radius:18px;
  background:#fff;
  box-shadow:var(--shadow);
}

/* make each metric lay out vertically but left-aligned so labels/values line up */
/* .metric{
  display:flex;
  flex-direction:column;
  gap:10px;
  text-align:left;
  align-items:flex-start;
  justify-content:center;
} */
.metric .label{ font-weight:600; color:var(--gray-1000); text-align:left; }

/* .metrics-card .metric-title,
.kpi-block .kpi-title,
.metrics h4 {
  font-size: .95rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
} */

/* seat bonus */
.stackbar{ display: none !important; }
.stackbar .seg{height:100%}
.stackbar .seg.red   { background:#EF5C67 }
.stackbar .seg.green { background:#2BC48A }
.stackbar .seg.purple{ background:#7B61FF }
.stackbar .seg.gray  { background:#DDE3F0 }
.legend-chips{display:flex;flex-wrap:wrap;gap:8px 10px;justify-content:center}
.chip{
  --c:#D0D7E6;
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;
  background:#F6F8FB;color:var(--gray-900);font-size:.9rem
}
.chip::before{
  content:"";width:10px;height:10px;border-radius:50%;background:var(--c);
  box-shadow:0 0 0 1px rgba(0,0,0,.08) inset;
}
.chip.red   { --c:#EF5C67 }
.chip.green { --c:#2BC48A }
.chip.purple{ --c:#7B61FF }

/* wasted votes donut */
.gauge{
  --v:25; --size:110px; --thick:12px;
  width:var(--size); height:var(--size); border-radius:50%;
  display:grid; place-items:center;
  background:
    conic-gradient(#4E6EF3 calc(var(--v)*1%), #E9EEF6 0),
    radial-gradient(circle calc(50% - var(--thick)), #fff 99%, transparent 0);
  box-shadow:0 1px 2px rgba(0,0,0,.04) inset;
}
.gauge > span{font-weight:700;color:#4E6EF3;font-size:1.15rem}

/* DI KPI */
.kpi{
  display:grid;place-items:center;
  width:110px;height:110px;border-radius:50%;
  background:rgba(239,92,103,.12);
}
.kpi .num{font-size:1.8rem;font-weight:700;color:#EF5C67;line-height:1}
.di .note{font-size:.85rem;color:var(--gray-600)}

/* methods card in control panel */
.control-panel .methods-card{
  margin-top:16px;
  padding:16px 18px;
  border-radius:18px;
  background:#fff;
  box-shadow:var(--shadow);
}

.methods-card .collapse-toggle{
  appearance:none; border:0; background:transparent;
  width:100%; display:flex; align-items:center; justify-content:space-between;
  padding:2px 0; cursor:pointer;
}
.methods-card .eyebrow{
  font-size:.9rem; letter-spacing:.14em; color:var(--gray-600);
}
.methods-card .chev{ transition: transform 160ms ease; color:var(--gray-600) }
.methods-card.is-collapsed .chev{ transform: rotate(-90deg) }

/* body + formulas */
.methods-body{
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transition: max-height 240ms ease, opacity 180ms ease;
}
.methods-card:not(.is-collapsed) .methods-body{
  max-height: 1000px;
  opacity: 1;
}

.method-list{ list-style:none; padding:0; margin:0; display:grid; gap:14px }
.m-title{ font-weight:600; color:var(--gray-1000); margin-bottom:4px }
.m-text{ color:var(--gray-900); font-size:.95rem; line-height:1.55 }
.m-text .m-muted{ color:var(--gray-600); margin-left:6px }

/* improved formula styling */
.math{
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  color: var(--gray-1000);
  background: #F7F9FD;
  border:1px solid var(--gray-200);
  border-radius:10px;
  padding:2px 8px;
  white-space: nowrap;
  line-height:1.25;
}
.math i{font-style:italic}
.math.chip{
  background:#F1F5FF;
  border-color:#E0E7FF;
  padding:4px 10px;
  border-radius:999px;
}
.math.block{
  display:block;
  width:100%;
  text-align:center;
  padding:8px 12px;
  margin-top:8px;
  background:#F7F9FD;
  border-left:3px solid #D7E3FF;
  white-space:normal;
}

/* floating "view results" pill (shown only on small screens) */
.fab-to-results{
  position: fixed;
  left: 50%;
  bottom: 16px;
  transform: translateX(-50%);
  z-index: 999;
  padding: 10px 16px;
  border: 0;
  border-radius: 999px;
  background: #3956F3;
  color: #fff;
  font-weight: 600;
  box-shadow: 0 8px 24px rgba(57,86,243,.28);
  display: none;
  cursor: pointer;
}

.metric.seat-bonus > :not(.top-list) {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 12px;
  width: 100%;
}

/* container for the rows */
/* .metric.seat-bonus .top-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-bottom: 12px;
  --rm-row-h: 56px;
  min-height: calc(var(--rm-row-h) * 3);
  transition: min-height .25s ease;
} */

/* align list rows into fixed columns so names always start at same x */
.top-list .top-row{
  display: grid;
  grid-template-columns: 12px minmax(320px, 1fr) 120px 88px 80px;
  column-gap: 16px;
  align-items: start;
  padding: 10px 0;
  border-bottom: 1px solid rgba(15,23,42,0.03);
}

.top-list .top-row.empty { color: var(--gray-400, #9AA3B3); }
.top-list .top-row.empty .party-name { font-weight: 600; color: var(--gray-400, #9AA3B3); }
.top-list .top-row.empty .votes,
.top-list .top-row.empty .bonus,
.top-list .top-row.empty .allocated { color: var(--gray-400, #9AA3B3); }

.top-list .top-row.header{
  display: grid;
  grid-template-columns: 12px minmax(320px, 1fr) 120px 88px 80px;
  column-gap: 16px;
  align-items: center;
  padding: 8px 0 12px;
  margin-bottom: 8px;
  border-bottom: 1px solid rgba(15,23,42,0.06);
  color: #6B7280;
  font-weight: 700;
  font-size: .78rem;
  text-transform: uppercase;
  letter-spacing: .09em;
}

.top-list .top-row.header .name-wrap.header-label,
.top-list .top-row.header .votes.header-label,
.top-list .top-row.header .bonus.header-label,
.top-list .top-row.header .allocated.header-label {
  display: block;
  color: inherit;
  font-weight: inherit;
}

.top-list .top-row.header .votes,
.top-list .top-row.header .bonus,
.top-list .top-row.header .allocated {
  text-align: right;
  color: #6B7280;
  font-weight: 700;
}

.top-list .top-row .votes { grid-column: 3 / 4; text-align: right; color:#64748b; }
/* .top-list .top-row .votes .votes-prev { color:#9AA3B3; font-weight:500; font-size:0.86rem; margin-right:6px; }
.top-list .top-row .votes .votes-arrow { color:#BCC6D1; margin:0 6px; font-weight:600; }
.top-list .top-row .votes .votes-new  { color:#111827; font-weight:700; font-size:0.95rem; } */
.top-list .top-row .votes { white-space:nowrap; }
.top-list .top-row .bonus{ grid-column: 4 / 5; text-align: right; font-weight:700; }
.top-list .top-row .allocated{ grid-column: 5 / 6; text-align: right; color:#475569; }

.top-list .top-row .votes .votes-prev,
.top-list .top-row .votes .votes-arrow {
  display: none !important;
}

.top-list .top-row.header .dot,
.top-list .top-row.header .header-dot {
  width: 12px;
  height: 12px;
  visibility: hidden;
}

.top-list .top-row.header .bonus,
.top-list .top-row.header .allocated {
  text-align: right;
}

/* keep the two-line clamp and wrapping for long names */
.top-list .top-row .party-name {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;

  overflow: hidden;
  white-space: normal;

  text-overflow: ellipsis;
  word-break: break-word;
  overflow-wrap: anywhere;
  
  line-height: 1.18rem;
  max-height: calc(1.18rem * 2);
  font-weight: 600;

  padding-left: 2px;
}

/* pager */
.metric.seat-bonus .top-pager {
  margin-top: 8px;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  padding-top: 6px;
  padding-bottom: 6px;
  position: relative;
  z-index: 5;
}

/* pager buttons */
.metric.seat-bonus .pager-btn {
  display: none !important;
}
.metric.seat-bonus .pager-btn:hover {
  background: #94a3b8;
  transform: scale(1.15);
}

/* dots */
.metric.seat-bonus .pager-dots {
  display: flex;
  gap: 4px;
}

.metric.seat-bonus .pager-dots .dot {
  width: 8px;
  height: 8px;
  aspect-ratio: 1 / 1;
  border-radius: 50%;
  background: #d5deea;
  border: none;
  padding: 0;
  display: inline-block;
  flex: 0 0 auto;
  cursor: pointer;
}

.metric.seat-bonus .pager-dots .dot.active {
  background: #9aa4b8;
}

/* SVG gauge styling (strong visible blue ring + top arc) */
.metric .gauge {
  transform: none !important;
  position: relative;
  display: inline-block;
  width: var(--size,110px);
  height: var(--size,110px);
}
.metric .gauge .gauge-svg {
  width: var(--size,110px);
  height: var(--size,110px);
  display: block;
}
.metric .gauge .g-bg {
  stroke: rgba(78,110,243,0.16);
  vector-effect: non-scaling-stroke;
}
.metric .gauge .g-arc {
  stroke: #4E6EF3;
  stroke-linecap: round;
  vector-effect: non-scaling-stroke;
  transform-origin: 50% 50%;
  transform: rotate(-90deg);
}

/* center the numeric label on top of the svg (animateCount uses the span) */
.metric .gauge > span {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 2;
  font-weight: 700;
  color: #4E6EF3;
  font-size: 1.15rem;
  pointer-events: none;
}

/* ensure old pseudo elements or background gradients don't interfere */
/* .gauge::before, .gauge::after { display: none !important; } */

/* KPI circle */
.kpi {
  display:grid; place-items:center;
  width:110px; height:110px; border-radius:50%;
  background: rgba(239,92,103,.12);
}
.kpi .num { font-size:1.8rem; font-weight:700; color:#EF5C67; line-height:1; }

/* Seat-bonus card split into top (table) + bottom (visuals) */
.metric.seat-bonus {
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items: stretch;
  --rm-row-h: 56px;
  /* --col-dot: 12px;
  --col-name-min: 320px;
  --col-votes: 120px;
  --col-bonus: 88px;
  --col-seats: 80px;
  --col-gap: 16px; */
}
/* .metric.seat-bonus {
  --rm-row-h: 56px;
  --col-dot: 12px;
  --col-name-min: 320px;
  --col-votes: 120px;
  --col-bonus: 88px;
  --col-seats: 80px;
  --col-gap: 16px;
} */

/* top: table + pager container (stretches full width) */
.metric.seat-bonus .seat-bonus-top {
  display: flex;
  flex-direction: column;
  width: 100%;
}

/* rows container (JS writes .top-list here) */
/* .metric.seat-bonus .top-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-bottom: 12px;
  --rm-row-h: 56px;
  min-height: calc(var(--rm-row-h) * 3);
} */
.metric.seat-bonus .top-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-bottom: 12px;
  --rm-row-h: 56px;
  /* min-height: calc(var(--rm-row-h) * 3); */
  min-height: calc(var(--rm-row-h) * 3 + 20px);
  transition: min-height .25s ease;
}

/* .metric.seat-bonus .top-list {
  min-height: unset !important;
} */

/* bottom: centered visuals (wasted + DI) */
.metric.seat-bonus .seat-bonus-bottom {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  gap: 120px;
  margin-top: 18px;
  width: 100%;
}

/* each bottom metric column */
.metric.seat-bonus .seat-bonus-bottom .metric {
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  width: auto;
}
/* .metric.seat-bonus .seat-bonus-bottom .metric .label { text-align:center; } */
.metric.seat-bonus .seat-bonus-bottom .metric .label {
  margin-bottom: 16px;
  display: block;
}

/* fixed visual widths */
.metric.seat-bonus .metric.wasted,
.metric.seat-bonus .metric.di {
  width: 160px;
  margin: 0;
}

/* pager (keeps existing look) */
.metric.seat-bonus .top-pager {
  margin-top: 8px;
  width: 100%;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  padding:6px 0;
}

/* small helper for labels */
.metric .label { font-size:.95rem; white-space:nowrap; }

@media (max-width: 1600px){
  .fab-to-results{ display: inline-flex; align-items: center; gap: 8px; }
}

@media (max-width:1600px){
  .map-card{ position: relative; }
  .map-card::after{
    content: "";
    position: absolute;
    left: 0; right: 0; bottom: 0;
    height: 56px;
    pointer-events: none;
    background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,.92));
    border-bottom-left-radius: inherit;
    border-bottom-right-radius: inherit;
  }
}

.metric .label{ font-size:.95rem; white-space:nowrap; }